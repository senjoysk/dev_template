# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with the dev_template repository.

## 🚨 重要: プロジェクト情報
**プロジェクト名**: dev_template
**概要**: Claude Code用の開発テンプレート。TDD開発を推進し、高品質なコードベースを構築するためのテンプレート集
**開発段階**: 継続的改善

## 🔴🟢♻️ 開発方針: t_wada式TDD

**すべての開発はテスト駆動開発（TDD）のRed-Green-Refactorサイクルで実施してください**

### TDDの基本サイクル
1. **🔴 Red**: 失敗するテストを書く
2. **🟢 Green**: テストを通す最小限の実装
3. **♻️ Refactor**: テストが通る状態を保ちながらリファクタリング

### t_wadaさんのTDD原則
- **テストファースト**: 実装前に必ずテストを書く
- **小さなステップ**: 一度に一つのことだけ
- **YAGNI (You Aren't Gonna Need It)**: 必要になるまで作らない
- **三角測量**: 複数のテストケースから一般化を導く
- **明白な実装**: シンプルで分かりやすいコードを書く

## TDDでのコーディング規約

### 1. テストファースト開発
- 実装を先に書かない
- テストから書き始める
- テストが失敗することを確認してから実装

### 2. テスタブルな設計
- **使い方から設計**: テストで理想的な使い方を先に書く
- **モジュール化**: 機能を小さく分割してテストしやすくする
- **環境変数の活用**: 設定を外部化して柔軟性を保つ

### 3. 実装規約
- スクリプトのエラーハンドリングを適切に行う
- 適切なデバッグ情報を出力する
- コメントは必要な箇所にのみ記載

## 🚨 必須: TDD開発フロー

### 新機能開発の手順
1. **🔴 Red Phase** - 失敗するテストを書く
   - TODOリストの作成（実装する機能を小さなタスクに分解）
   - 最初のテストケースの決定（最も簡単なケースから）
   - テストが失敗することを確認

2. **🟢 Green Phase** - テストを通す
   - 最小限の実装（仮実装でもOK）
   - テストが通ることを確認

3. **♻️ Refactor Phase** - リファクタリング
   - テストが通る状態を維持しながら改善
   - より良い設計に変更

4. **繰り返し**
   - 次のテストケースに進む

### コーディング前の必須確認
- [ ] TODOリストの作成（実装する機能を小さなタスクに分解）
- [ ] 最初のテストケースの決定（最も簀単なケースから）
- [ ] スクリプトのインターフェース設計（使い方から考える）
- [ ] エラーケースの洗い出し

## 🚨 Claude Code: タスク完了前の必須確認

**Claude Codeは依頼されたタスクを完了したと判断する前に、以下を必ず確認してください:**

### タスク完了前の品質ゲート
1. コードが正しく動作することを確認
2. テストが存在する場合は実行して確認
3. エラーハンドリングが適切に実装されていることを確認

### 実行タイミング
- **タスク実装完了後**: コードの実装やファイル変更が完了した時点
- **完了報告前**: ユーザーに「完了しました」と報告する前

### 目的
- **早期問題検出**: 開発時点で問題を検出
- **品質保証**: 動作確認
- **開発速度向上**: 後戻り作業の削減

## 📋 開発チェックリスト

### 🚨 絶対に守るべきTDDルール
1. **テストなしでコードを書かない**
2. **失敗するテストを確認してから実装**
3. **一度に一つのことだけ**
4. **明白な実装を心がける**
5. **TODOリストで進捗管理**

**🚨 CRITICAL: 実装前に必ずテストを書き、Red-Green-Refactorサイクルを守ること**

## 🔄 TDDコメント管理のベストプラクティス

### フェーズ別コメント管理手順

#### 1. **🔴 Red Phase - 失敗するテストを書く**
- テストコメントに「🔴 Red Phase: 機能名 - 実装前なので失敗する」と記載
- 失敗することを確認

#### 2. **🟢 Green Phase - テストを通す最小限の実装**
- コメントを「🟢 Green Phase: 機能名 - 最小限の実装でテストが通る」に更新
- テストが通ることを確認

#### 3. **♻️ Refactor Phase - リファクタリング**
- コメントを「♻️ Refactor Phase: 機能名 - リファクタリング完了」に更新
- テストが通る状態を維持

### 実装完了後のコメント整理
- フェーズ表記を削除し、機能説明に変更
- テストの意図を明確に記述

## プロジェクトの目的

このプロジェクトは、新規プロジェクトを開始する際に以下を提供します：
1. **Stage 1**: 基本的なClaude Code環境（CLAUDE.md、開発ガイド、基本スクリプト）
2. **Stage 2**: 技術スタック別の詳細設定（コードレビュースクリプト、テスト分析ツール）

## ディレクトリ構造

```
dev_template/
├── stage1/                     # Stage 1テンプレート（基本環境）
│   ├── CLAUDE.md              # プロジェクト用CLAUDE.md
│   ├── DEVELOPMENT_GUIDE.md   # 開発者向けガイド
│   ├── DEVELOPMENT_CHECKLIST.md # TDDチェックリスト
│   ├── README.md              # プロジェクトREADME
│   ├── .gitignore             # Git除外設定
│   └── scripts/               # 基本スクリプト
│       └── worktree.sh        # Git worktree管理
├── stage2/                     # Stage 2テンプレート（技術スタック別）
│   ├── node-typescript/       # Node.js + TypeScript用
│   │   └── scripts/
│   │       ├── code-review/   # コード品質チェック
│   │       └── test-analysis/ # テスト分析
│   └── python/                # Python用
│       └── scripts/
│           ├── code-review/   # コード品質チェック
│           └── test-analysis/ # テスト分析
├── scripts/                    # 初期化スクリプト
│   ├── init-stage1.sh         # Stage 1適用スクリプト
│   ├── init-stage2.sh         # Stage 2適用スクリプト
│   └── run-tests.sh           # テスト実行スクリプト
└── tests/                      # テストスイート
    ├── test_init_stage1.bats  # Stage 1テスト
    ├── test_init_stage2.bats  # Stage 2テスト
    └── test_diff_functions.bats # 差分機能テスト
```

## 開発ガイドライン

### 新機能追加時の手順

1. **テストファースト**
   ```bash
   # テストを先に書く
   touch tests/test_new_feature.bats
   ./scripts/run-tests.sh -v
   ```

2. **実装**
   - Stage 1に追加: 全プロジェクト共通の基本機能
   - Stage 2に追加: 技術スタック固有の機能

3. **ドキュメント更新**
   - README.mdに使用方法を追記
   - 該当するCLAUDE.mdテンプレートを更新

### コミット前の確認

```bash
# テスト実行
./scripts/run-tests.sh

# Stage 1の動作確認
./scripts/init-stage1.sh

# Stage 2の動作確認（例：Node.js）
./scripts/init-stage2.sh --stack=node-typescript
```

## テンプレートのメンテナンス

### Stage 1テンプレート
- **CLAUDE.md**: TDD原則、エラー処理、ログ、型安全性規約を含む（プロジェクト用）
- **DEVELOPMENT_GUIDE.md**: プロジェクト固有の開発ガイド
- **DEVELOPMENT_CHECKLIST.md**: TDDチェックリスト
- **基本スクリプト**: worktree管理など

### Stage 2テンプレート
- **コードレビュースクリプト**:
  - `srp-check.sh`: 単一責任原則チェック
  - `file-size-check.sh`: ファイルサイズ監視
  - `error-handling-check.sh`: エラー処理規約チェック
  - `console-usage-check.sh`: console/print使用検出
  - `type-safety-check.sh`: 型安全性チェック
  - `dependency-injection-check.sh`: DI品質チェック

## 重要な設計決定

1. **2段階アプローチ**: 基本環境と技術スタック固有設定を分離
2. **既存ファイルの保護**: スキップして差分レポート生成
3. **汎用性**: 環境変数でカスタマイズ可能
4. **テスト駆動**: Batsによる包括的なテスト

## 🚨 Claude Code: 開発時の注意

このプロジェクトを変更する際は：
1. **既存のテストを実行**して動作を確認
2. **新機能にはテストを追加**
3. **後方互換性を維持**（既存プロジェクトへの影響を考慮）
4. **ドキュメントを更新**

---

**🎯 本プロジェクトは、高品質なソフトウェア開発を支援するテンプレート集です。継続的に改善し、開発者の生産性向上に貢献しましょう。**